\documentclass[12pt,a4paper]{article}

% Font stuff
\usepackage{fontspec}

% lets use roboto because it is open and quite nice, or?
% \setmainfont{Roboto}[
%   Path           = ../fonts/,
%   Extension      = .ttf,
%   UprightFont    = *-Regular,
%   ItalicFont     = *-Italic,
%   BoldFont       = *-Bold,
%   BoldItalicFont = *-BoldItalic,
% ]

% Switch from babel to improve word wrapping etc with Swedish
%\usepackage[swedish]{babel}
\usepackage{polyglossia}
\setmainlanguage{swedish}

\usepackage[left=2.5cm,right=2.5cm,top=1.5cm,bottom=4cm]{geometry}
\setlength{\headheight}{82pt}

%% Important tex cmds
\usepackage{pdftexcmds}
\usepackage{tabularx}

\usepackage[document]{ragged2e}
% Mathptmx ruins unicode it seems
%\usepackage{mathptmx}
\usepackage{fancyhdr}
\usepackage{lastpage}
\usepackage{graphicx}
\usepackage{varwidth}

% Kommenterar ut 2024-04-18
% \makeatletter
% \def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
% \def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
% \makeatother
% % Scale images if necessary, so that they will not overflow the page
% % margins by default, and it is still possible to overwrite the defaults
% % using explicit options in \includegraphics[width, height, ...]{}
% \setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% % Set default figure placement to htbp
% \makeatletter
% \def\fps@figure{htbp}
% \makeatother

\usepackage{lipsum}
\usepackage[hidelinks]{hyperref}
% \usepackage{longtable}
\usepackage{booktabs}

% MAGI
% https://github.com/jgm/pandoc/issues/7475#issuecomment-1829790171
% byter longtable mot tabularray som är bättre
$if(tables)$
\usepackage{tabularray}
\let\longtable\longtblr
\let\endlongtable\endlongtblr
\NewTblrTheme{headless}{
    \DefTblrTemplate{contfoot-text}{default}{}
    \DefTblrTemplate{conthead-text}{default}{}
    \DefTblrTemplate{caption}{default}{}
    \DefTblrTemplate{conthead}{default}{}
    \DefTblrTemplate{capcont}{default}{}
}
\SetTblrOuter[longtblr]{
    entry=none,
    label=none,
    theme=headless,
}
\let\noalign\empty
\def\endlastfoot{\hspace{-2.5mm}} % compensate whitespace produced by left over \empty tokens
\let\endhead\empty
\def\toprule{\hspace{-1mm}} % compensate whitespace produced by left over \empty tokens
\let\midrule\empty
\let\bottomrule\empty
% add some optional styling
\UseTblrLibrary{varwidth}
\SetTblrInner[longtblr]{
  row{1}     = {gray!20,valign=h},
  hline{1,Z} = {0.3mm},
  hline{2}   = {0.1mm},
  row{Z}     = {valign=f},
  row{odd}   = {gray!5},
  hspan      = minimal,
  columns    = {co=1,valign=t},
}
$endif$

\usepackage[compact]{titlesec}

%% flindeberg-playground april 2024
\usepackage{amsmath,amssymb}
\usepackage{listings,iftex}
\usepackage{microtype,parskip}

% Include packages for mermaid etc
\usepackage{framed}

\providecommand{\tightlist}{%
  \setlength{\itemsep}{2pt}\setlength{\parskip}{0pt}\setlength{\partopsep}{2pt}\setlength{\topsep}{2pt}}

\renewcommand\labelitemi{--}

% flindeberg added
\newcommand{\real}[1]{#1}

\setcounter{secnumdepth}{0}
\setlength{\parskip}{0.5cm}
\setlength{\parindent}{0.0mm}

\setcounter{tocdepth}{1}

\pagestyle{fancy}
\fancyhf{}

\lhead{\raisebox{-0.5\height}{\includegraphics[width=3cm]{../template/tu-logo}}}

\chead{\raisebox{-0.6\height}{\parbox[b][][t]{5.5cm}{%
\begin{center}
\large
$shorttitle$
\end{center}}}}

\rhead{\begin{tabular}{rl}
Beteckning: & $designation$\\
Version: & $version$\\
Datum: & $date$\\
Sida: & \thepage~av~\pageref{LastPage}
\end{tabular}}

\begin{document}

\section*{$title$}

$if(toc)$
\tableofcontents
$endif$

$if(versions)$
\section{Versionshistorik}
\begin{longtable}[]{@{}lll@{}}
\toprule
Version & Beskrivning\tabularnewline%
\midrule
\endhead%
$for(versions)$
$versions.version$ & $versions.description$\tabularnewline%
$endfor$
\bottomrule
\end{longtable}
$endif$

$body$
\end{document}
